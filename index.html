<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DinoMates - Edici√≥n Llorens</title>
    <!-- Tailwind CSS para los estilos -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React y Babel para procesar JSX en el navegador -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-20px); }
            75% { transform: translateX(20px); }
        }
        .animate-shake { animation: shake 0.2s ease-in-out infinite; }
        
        body {
            margin: 0;
            overflow: hidden;
            background-color: #1a2e05;
        }

        .bg-noise::after {
            content: "";
            position: absolute;
            inset: 0;
            opacity: 0.05;
            pointer-events: none;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;

        // Iconos manuales en SVG
        const TrophyIcon = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="text-[#ffd700]"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg>
        );

        const RotateIcon = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>
        );

        const SettingsIcon = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>
        );

        const App = () => {
            const [gameState, setGameState] = useState('menu'); 
            const [mode, setMode] = useState(null);
            const [difficulty, setDifficulty] = useState('principiante');
            const [score, setScore] = useState(0);
            const [question, setQuestion] = useState({ a: 0, b: 0, op: '', answer: 0 });
            const [options, setOptions] = useState([]);
            const [feedback, setFeedback] = useState(null);
            const [medals, setMedals] = useState([]);
            
            const childName = "Llorens";

            const medalConfig = [
                { id: 'huevo', name: 'Huevo de Dino', points: 50, icon: 'ü•ö' },
                { id: 'bebe', name: 'Dino Beb√©', points: 150, icon: 'ü¶ñ' },
                { id: 'tricera', name: 'Triceratops', points: 300, icon: 'üõ°Ô∏è' },
                { id: 't-rex', name: 'Rey T-Rex', points: 500, icon: 'üëë' },
            ];

            const playSound = (type) => {
                try {
                    const ctx = new (window.AudioContext || window.webkitAudioContext)();
                    const osc = ctx.createOscillator();
                    const gain = ctx.createGain();
                    osc.connect(gain);
                    gain.connect(ctx.destination);
                    if (type === 'success') {
                        osc.type = 'triangle';
                        osc.frequency.setValueAtTime(523.25, ctx.currentTime);
                        osc.frequency.exponentialRampToValueAtTime(1046.50, ctx.currentTime + 0.1);
                        gain.gain.setValueAtTime(0.1, ctx.currentTime);
                        gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.4);
                        osc.start();
                        osc.stop(ctx.currentTime + 0.4);
                    } else {
                        osc.type = 'sawtooth';
                        osc.frequency.setValueAtTime(110, ctx.currentTime);
                        osc.frequency.linearRampToValueAtTime(40, ctx.currentTime + 0.2);
                        gain.gain.setValueAtTime(0.1, ctx.currentTime);
                        gain.gain.linearRampToValueAtTime(0.01, ctx.currentTime + 0.3);
                        osc.start();
                        osc.stop(ctx.currentTime + 0.3);
                    }
                } catch (e) {}
            };

            const speak = (text) => {
                if ('speechSynthesis' in window) {
                    window.speechSynthesis.cancel();
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.lang = 'es-ES';
                    utterance.pitch = 1.4; 
                    utterance.rate = 1.1;
                    window.speechSynthesis.speak(utterance);
                }
            };

            const generateQuestion = useCallback((currentMode, currentDiff) => {
                let a, b, op, ans;
                const diff = currentDiff || difficulty;
                const m = currentMode || mode;
                let maxNum = 10;
                if (diff === 'medio') maxNum = 30;
                if (diff === 'avanzado') maxNum = 100;

                if (m === 'suma') {
                    a = Math.floor(Math.random() * maxNum) + 1;
                    b = Math.floor(Math.random() * maxNum) + 1;
                    op = '+';
                    ans = a + b;
                } else if (m === 'resta') {
                    a = Math.floor(Math.random() * maxNum) + (maxNum / 2);
                    b = Math.floor(Math.random() * a) + 1;
                    op = '-';
                    ans = a - b;
                } else {
                    let multMax = diff === 'principiante' ? 5 : (diff === 'medio' ? 10 : 12);
                    a = Math.floor(Math.random() * multMax) + 1;
                    b = Math.floor(Math.random() * 10) + 1;
                    op = '√ó';
                    ans = a * b;
                }

                setQuestion({ a, b, op, answer: ans });
                let opts = [ans];
                while (opts.length < 4) {
                    let range = diff === 'avanzado' ? 20 : 10;
                    let wrong = ans + (Math.floor(Math.random() * range) + 1) * (Math.random() > 0.5 ? 1 : -1);
                    if (wrong >= 0 && !opts.includes(wrong)) opts.push(wrong);
                }
                setOptions(opts.sort(() => Math.random() - 0.5));
            }, [difficulty, mode]);

            const selectMode = (type) => {
                setMode(type);
                setGameState('difficulty');
                speak(`¬°Muy bien ${childName}! Elige tu nivel de explorador.`);
            };

            const startLevel = (diff) => {
                setDifficulty(diff);
                setGameState('playing');
                generateQuestion(mode, diff);
            };

            const handleAnswer = (selected) => {
                if (selected === question.answer) {
                    setFeedback('correct');
                    playSound('success');
                    const phrases = [`¬°Roooar! ¬°Incre√≠ble ${childName}!`, `¬°Dino-√©xito total ${childName}!`, `¬°Rey de la selva ${childName}!`, `¬°Magn√≠fico ${childName}!`];
                    speak(phrases[Math.floor(Math.random() * phrases.length)]);
                    const newScore = score + 10;
                    setScore(newScore);
                    const earned = medalConfig.filter(m => newScore >= m.points && !medals.includes(m.id)).map(m => m.id);
                    if (earned.length > 0) {
                        setMedals([...medals, ...earned]);
                        speak(`¬°Has encontrado un nuevo dinosaurio ${childName}!`);
                    }
                    setTimeout(() => { setFeedback(null); generateQuestion(); }, 1500);
                } else {
                    setFeedback('wrong');
                    playSound('error');
                    setTimeout(() => setFeedback(null), 800);
                }
            };

            return (
                <div className="min-h-[100dvh] bg-gradient-to-b from-[#1a2e05] via-[#2d4a22] to-[#132406] font-sans p-4 flex flex-col items-center touch-manipulation select-none overflow-hidden relative bg-noise">
                    <div className="absolute top-[-20px] left-[-20px] opacity-10 text-9xl">üåø</div>
                    <div className="absolute bottom-20 left-[-20px] opacity-20 text-7xl rotate-12">üë£</div>

                    <header className="w-full max-w-lg bg-[#d9c5a0] rounded-2xl p-3 shadow-[0_8px_0_#8b7355] flex justify-between items-center mb-6 border-4 border-[#5c4033] z-10">
                        <div className="flex flex-col items-start px-2">
                            <span className="text-[10px] font-black text-[#5c4033] uppercase leading-none mb-1">Explorador: {childName}</span>
                            <div className="flex items-center gap-2">
                                <div className="bg-[#5c4033] p-1 rounded-full border border-[#ffd700]">
                                    <TrophyIcon />
                                </div>
                                <span className="text-2xl font-black text-[#5c4033]">{score}</span>
                            </div>
                        </div>
                        <div className="flex gap-1.5 bg-black/10 p-2 rounded-xl border border-white/20">
                            {medalConfig.map(m => (
                                <span key={m.id} className={`text-2xl transition-all duration-500 ${medals.includes(m.id) ? 'scale-125 drop-shadow-md' : 'grayscale opacity-30 contrast-50'}`}>
                                    {m.icon}
                                </span>
                            ))}
                        </div>
                        <div className="flex gap-2">
                            {gameState === 'playing' && (
                                <button onClick={() => setGameState('difficulty')} className="p-2 bg-[#ca8a04] rounded-full active:scale-90 border-2 border-[#5c4033] flex items-center justify-center text-white shadow-md">
                                    <SettingsIcon />
                                </button>
                            )}
                            <button onClick={() => location.reload()} className="p-2 bg-[#8b5a2b] rounded-full active:scale-90 border-2 border-[#5c4033] flex items-center justify-center text-[#f5f5dc]">
                               <RotateIcon />
                            </button>
                        </div>
                    </header>

                    <main className="w-full max-w-lg flex-grow flex flex-col justify-center gap-6 z-10">
                        {gameState === 'menu' && (
                            <div className="text-center animate-in fade-in zoom-in">
                                <div className="relative inline-block mb-4">
                                    <h1 className="text-6xl font-black text-[#facc15] drop-shadow-[0_6px_0_#854d0e] tracking-tight">DINOMATES</h1>
                                    <div className="absolute -top-6 -right-8 rotate-12 bg-red-600 text-white text-[10px] font-bold px-2 py-1 rounded-md border-2 border-white">EDICI√ìN {childName.toUpperCase()}</div>
                                </div>
                                <p className="text-[#bef264] font-black mb-8 uppercase tracking-[0.3em] text-sm">Sobrevive a las Cifras</p>
                                <div className="grid gap-5">
                                    {[
                                        { id: 'suma', label: 'Sumar', icon: 'ü¶ï', color: 'bg-[#4ade80] border-[#166534]' },
                                        { id: 'resta', label: 'Restar', icon: 'ü¶ñ', color: 'bg-[#fb923c] border-[#9a3412]' },
                                        { id: 'multi', label: 'Multiplicar', icon: 'ü¶Ö', color: 'bg-[#f472b6] border-[#9d174d]' }
                                    ].map(b => (
                                        <button key={b.id} onClick={() => selectMode(b.id)} className={`${b.color} w-full py-6 rounded-[2.5rem] border-b-[10px] flex items-center justify-between px-10 text-white text-3xl font-black active:translate-y-2 active:border-b-4 transition-all shadow-xl`}>
                                            <span className="text-5xl">{b.icon}</span> {b.label} 
                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><path d="m9 18 6-6-6-6"/></svg>
                                        </button>
                                    ))}
                                </div>
                            </div>
                        )}

                        {gameState === 'difficulty' && (
                            <div className="text-center px-4 animate-in fade-in slide-in-from-bottom-4">
                                <h2 className="text-3xl font-black text-[#fef08a] mb-8 uppercase italic tracking-wider">¬øQu√© tan valiente eres, {childName}?</h2>
                                <div className="grid gap-5">
                                    {[
                                        { id: 'principiante', label: 'Herb√≠voro', color: 'bg-[#86efac] border-[#166534] text-[#064e3b]' },
                                        { id: 'medio', label: 'Cazador', color: 'bg-[#fde047] border-[#854d0e] text-[#422006]' },
                                        { id: 'avanzado', label: 'Depredador', color: 'bg-[#f87171] border-[#7f1d1d] text-white' }
                                    ].map(d => (
                                        <button key={d.id} onClick={() => startLevel(d.id)} className={`${d.color} w-full p-6 rounded-3xl border-b-[10px] active:translate-y-2 active:border-b-4 transition-all shadow-xl font-black text-2xl uppercase flex flex-center justify-center items-center gap-3`}>
                                            {difficulty === d.id && <span className="text-sm">‚òÖ</span>}
                                            {d.label}
                                            {difficulty === d.id && <span className="text-sm">‚òÖ</span>}
                                        </button>
                                    ))}
                                    <button onClick={() => setGameState(mode ? 'playing' : 'menu')} className="mt-6 text-[#bef264] font-black uppercase text-sm tracking-widest bg-black/20 py-3 rounded-full border border-white/10 active:scale-95 transition-transform">
                                        {mode ? '‚Üê Volver a la Partida' : '‚Üê Volver al Men√∫'}
                                    </button>
                                </div>
                            </div>
                        )}

                        {gameState === 'playing' && (
                            <div className="bg-[#fefce8] rounded-[3.5rem] p-8 shadow-2xl border-b-[16px] border-[#eab308] relative overflow-hidden flex flex-col items-center border-4 border-[#5c4033] animate-in zoom-in-95 duration-300">
                                {feedback === 'correct' && (
                                    <div className="absolute inset-0 bg-[#4ade80]/95 flex flex-col items-center justify-center z-20">
                                        <div className="text-9xl mb-4">üëè</div>
                                        <h2 className="text-5xl font-black text-white">¬°GIGANTE!</h2>
                                    </div>
                                )}
                                {feedback === 'wrong' && (
                                    <div className="absolute inset-0 bg-[#ef4444]/95 flex flex-col items-center justify-center z-20 animate-shake">
                                        <div className="text-8xl mb-4">üíÄ</div>
                                        <h2 className="text-4xl font-black text-white italic">¬°CUIDADO!</h2>
                                    </div>
                                )}
                                
                                <div className="absolute top-4 left-6 text-[#854d0e] font-black text-xs uppercase tracking-tighter opacity-60">
                                    Nivel: {difficulty}
                                </div>

                                <div className="flex items-center gap-6 bg-[#f5f5dc] p-10 rounded-[3rem] shadow-inner border-4 border-[#d2b48c] mb-12">
                                    <span className="text-7xl font-black text-[#422006]">{question.a}</span>
                                    <span className="text-4xl font-black text-[#ca8a04]">{question.op}</span>
                                    <span className="text-7xl font-black text-[#422006]">{question.b}</span>
                                </div>
                                <div className="grid grid-cols-2 gap-5 w-full">
                                    {options.map((opt, i) => (
                                        <button key={i} onClick={() => handleAnswer(opt)} className="bg-[#16a34a] text-white py-8 rounded-[2.5rem] text-5xl font-black border-b-[10px] border-[#14532d] active:translate-y-2 active:border-b-2 transition-all shadow-xl">{opt}</button>
                                    ))}
                                </div>
                            </div>
                        )}
                    </main>

                    <footer className="w-full max-w-lg mt-auto py-6 flex justify-around items-end">
                        <span className="text-4xl">ü¶ñ</span>
                        <span className="text-5xl">üåã</span>
                        <span className="text-4xl">ü¶ï</span>
                        <span className="text-3xl">üå¥</span>
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
